<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="SablefishMSE">
<title>Specifying Recruitment • SablefishMSE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Specifying Recruitment">
<meta property="og:description" content="SablefishMSE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">SablefishMSE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.0000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/SablefishMSE.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/02_estimation_model.html">Sablefish MSE Estimation Method</a>
    <a class="dropdown-item" href="../articles/03_recruitment_functions.html">Specifying Recruitment</a>
    <a class="dropdown-item" href="../articles/04_harvest_control_rule_function.html">Harvest Control Rules</a>
    <a class="dropdown-item" href="../articles/05_processing_mse_results.html">Processing MSE Results</a>
    <a class="dropdown-item" href="../articles/06_multiple_mse_simulations.html">Multiple MSE Simulations</a>
    <a class="dropdown-item" href="../articles/07_plotting_mse_results.html">UNKNOWN TITLE</a>
    <a class="dropdown-item" href="../articles/mse_options.html">MSE Options</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Specifying Recruitment</h1>
            
      
      
      <div class="d-none name"><code>03_recruitment_functions.Rmd</code></div>
    </div>

    
    
<p>As part of the <code>model_options</code> list that is a required input to the MSE function, users must specify a recruitment function as well as relevant parameter values for the OM to project future recruitment. Some simple recruitment functions are prepackaged with the model – a Beverton-Holt stock recruit function, a function that resamples from the historical recruitment timeseries, and two different functions that specify distinct recruitment regimes – but users are also able to specify their own custom recruitment functions, as necesarry.</p>
<p>A simple example of specifying a recruitment function for the MSE is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">resample_recruits</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">hist_recruits</span>, <span class="va">nyears</span>, <span class="va">seed</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="va">hist_recruits</span>, size<span class="op">=</span><span class="va">nyears</span>, replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">om</span><span class="op">$</span><span class="va">recruitment</span><span class="op">$</span><span class="va">func</span> <span class="op">&lt;-</span> <span class="va">resample_recruits</span></span>
<span><span class="va">om</span><span class="op">$</span><span class="va">recruitment</span><span class="op">$</span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    hist_recruits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, mean<span class="op">=</span><span class="fl">25</span>, sd<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>    nyears <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>om$recruitment$func</code> list element is a reference to the recruitment function that should be used to project recruitment in the future, while <code>om$recruitment$pars</code> is a named list of parameter values spcific to the provided recruitment function. Note that the final required parameter in <code>resample_recruits</code>, “seed”, is not povided in the <code>recruitment$pars</code> list. Instead, this parameter is dynmically passed to the recruitment function within the MSE loop, thus ensuring that recruitment timeseries remain reproducible across multiple simpulations.</p>
<div class="section level4">
<h4 id="working-with-existing-recruitment-functions">Working with Existing Recruitment functions<a class="anchor" aria-label="anchor" href="#working-with-existing-recruitment-functions"></a>
</h4>
<p>Four recruitment functions come pre-packaged with the repository:</p>
<ol style="list-style-type: decimal">
<li>
<code>resample_recruits</code> - randomly resample from a known recruitment timeseries</li>
<li>
<code>resample_regime_recruits</code> - randomly resample recruits form a known recruitment timeseries with pre-defined regimes</li>
<li>
<code>regime_recruits</code> - randonly draw recruitment from regime-specific distributions</li>
<li>
<code>beverton_holt</code> - a Beverton-Holt stock recruit relationships, parameterized with steepness</li>
</ol>
<p>The first three functions all function in the same way as in the example above, where users simple provide the function name, and a named parameter list (without the final <code>seed</code> parameter).</p>
<p>The <code>beverton_holt</code> function works differently however, due to it specifying a state-dependent recruitment function. This function is an R function factory (a funtion that returns another function), that accepts the standard Beverton-Holt parameters – h, R0, and S0 – and returns back a new function to which SSB is provided an input (see the example below).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beverton_holt</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">h</span>, <span class="va">R0</span>, <span class="va">S0</span>, <span class="va">sigR</span>, <span class="va">seed</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># note that the set.seed() call needs to happen</span></span>
<span>    <span class="co"># outside of the returned function, or else there</span></span>
<span>    <span class="co"># will be no random variability in recruitment draws</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span> </span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">ssb</span><span class="op">)</span><span class="op">{</span></span>
<span>        <span class="va">bh</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="va">R0</span><span class="op">*</span><span class="va">h</span><span class="op">*</span><span class="va">ssb</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">h</span><span class="op">)</span><span class="op">*</span><span class="va">R0</span><span class="op">*</span><span class="op">(</span><span class="va">S0</span><span class="op">/</span><span class="va">R0</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">5</span><span class="op">*</span><span class="va">h</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">*</span><span class="va">ssb</span><span class="op">)</span></span>
<span>        <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>            <span class="va">bh</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">1</span>, mean<span class="op">=</span><span class="fl">0</span>, sd<span class="op">=</span><span class="va">sigR</span><span class="op">)</span><span class="op">)</span> <span class="co"># lognormal deviates</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">bevholt</span> <span class="op">&lt;-</span> <span class="fu">beverton_holt</span><span class="op">(</span>h<span class="op">=</span><span class="fl">0.7</span>, R0<span class="op">=</span><span class="fl">25</span>, S0<span class="op">=</span><span class="fl">300</span>, sigR<span class="op">=</span><span class="fl">1</span>, seed<span class="op">=</span><span class="fl">1120</span><span class="op">)</span></span>
<span><span class="fu">bevholt</span><span class="op">(</span>ssb<span class="op">=</span><span class="fl">50</span><span class="op">)</span> <span class="co"># 16.65</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 17.74222</span></span></code></pre>
<p>This function factory can be used in nearly exactly the same way as the previous three recruitment functions:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">om</span><span class="op">$</span><span class="va">recruitment</span><span class="op">$</span><span class="va">func</span> <span class="op">&lt;-</span> <span class="va">beverton_holt</span></span>
<span><span class="va">om</span><span class="op">$</span><span class="va">recruitment</span><span class="op">$</span><span class="va">pars</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    h<span class="op">=</span><span class="fl">0.70</span>,</span>
<span>    R0<span class="op">=</span><span class="fl">25</span>,</span>
<span>    S0<span class="op">=</span><span class="fl">300</span>,</span>
<span>    sigR<span class="op">=</span><span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Like with the other recruitment functions, the final “seed” parameter is not provided as input in the <code>recruitmemt$pars</code> list. The MSE will internally handle computing SSB at the beginning of each year and using the defined SRR to generate an annual recruitment level.</p>
</div>
<div class="section level4">
<h4 id="defining-custom-recruitment-functions">Defining Custom Recruitment Functions<a class="anchor" aria-label="anchor" href="#defining-custom-recruitment-functions"></a>
</h4>
<p>Users can, optionally, define their own recruitment functions beyond what comes pre-packaged with the MSE.</p>
<p>There are two types of recruitment functions that can be developed: those which are state-dependent (such as the Beverton-Holt), and those that are not state-dependent (such as the recruitment regime functions). State-independent recruitment functions have the useful property that the entire recruitment timeseries can be defined before the MSE simulation starts (which is helpful for guaranteeing reproducability between model runs), while state-depenedent functions are only realized at the start of each simulation year. Where possible, we recommend defining state-independent recruitment functions.</p>
<p>The R function that defines a custom recruitment function, regardless of type, can take any form it needs too with the important caveat that the final function pararmeter must be called “seed” and represent a random seed (this holds even if the custom recruitment functions is completely deterministic). Below is an example of a recruitment function that random pulls recruitment from a lognormal distribution:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">random_lognormal</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">log_mean_rec</span>, <span class="va">sigR</span>, <span class="va">nyears</span>, <span class="va">seed</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="va">seed</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">log_mean_rec</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">nyears</span>, <span class="fl">0</span>, <span class="va">sigR</span><span class="op">)</span> <span class="op">-</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">sigR</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">random_lognormal</span><span class="op">(</span>log_mean_rec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">25</span><span class="op">)</span>, sigR <span class="op">=</span> <span class="fl">1.04</span>, nyears <span class="op">=</span> <span class="fl">5</span>, seed <span class="op">=</span> <span class="fl">1007</span><span class="op">)</span> <span class="co"># 25.022 19.746 55.721 14.737 5.858</span></span></code></pre></div>
<p>This is an example of a “state-independent” recruitment function. The function takes a mean recruitment level (in log space) and a recruitment variation and computes <code>nyears</code> random recruitment levels. Nearly all such state-independent recruitment functions will need to accept an <code>nyears</code> parameter in order to generate the correct number of recruitment events. Similarly, like all recruitment functions, the final parameter defines a random seed.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Joshua Zahner, Benjamin Williams, Dan Goethel, Curry Cunningham, Matt Cheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>

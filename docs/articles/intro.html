<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intro â€¢ SablefishMSE</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Intro">
<meta property="og:description" content="SablefishMSE">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">SablefishMSE</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0.0000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro.html">Intro</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Intro</h1>
            
      
      
      <div class="hidden name"><code>intro.Rmd</code></div>

    </div>

    
    
<p>The <code>SablefishMSE</code> package was developed to facilitate the evaluation of alternative harvest control rules, management policies (such as discarding), and TAC apportionment strategies for Alaska sablefish (<em>Anoplopoma fimbria</em>) under the jurisidiction of the United States North Pacific Fisheries Management Council (NPFMC).</p>
<hr>
<p>The <code>SablefishMSE</code> package can be downloaded and installed using:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"ovec8hkin/SablefishMSE"</span>)<span class="st">`</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="at">library(afscOM)</span></span></code></pre></div>
<div class="section level3">
<h3 id="a-simple-example">A Simple Example<a class="anchor" aria-label="anchor" href="#a-simple-example"></a>
</h3>
<p>A simple runnable example is available at <code>dev/sablefish_mse_example.r</code>.</p>
<p>The primary R function that runs the MSE simulation loop is:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/run_mse.html">run_mse</a></span><span class="op">(</span></span>
<span>  om<span class="op">=</span><span class="va">sable_om</span>,</span>
<span>  hcr<span class="op">=</span><span class="va">tier3</span>,</span>
<span>  nyears_input <span class="op">=</span> <span class="va">nyears</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Below, we break down the components that go into the <code>om</code> and <code>hcr</code> parameters.</p>
<div class="section level5">
<h5 id="setting-up-the-operating-model">Setting up the Operating Model<a class="anchor" aria-label="anchor" href="#setting-up-the-operating-model"></a>
</h5>
<p>First, we start with defining the operating model.</p>
<p>This package relies on the <code>afscOM</code> package to run the forward OM projection component of the MSE, as well as to generate observation data. <code>afscOM</code> requires users to define two objects to control the behavior of the forward projection: a <code>dem_params</code> list and a <code>model_options</code> list.</p>
<p>The <code>dem_params</code> list is a named list of multi-dimensional arrays that define demographic parameters within the OM. The <code>model_options</code> list is a complex named list of various options that control, among other things, the details of the observation processes and how catches are apportioned between fleets. For more details on the proper construction of these objects, please see the <code>afscOM</code> repository.</p>
<p><code>SablefishMSE</code> requires users to pass a named list that defines all of the components of the OM to the MSE wrapper function, which includes two additional components beyond what is required by <code>afscOM</code>. The components are:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">sable_om</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<code>dem_params</code> is exactly the <code>dem_params</code> list that is supplied to <code>afscOM</code>.</li>
<li>
<code>model_options</code> is the same list supplied to <code>afscOM</code> but with some extra options appended.</li>
<li>
<code>init_naa</code> is the the initial numbers-at-age (and sex) vector from which the OM should begin.</li>
<li>
<code>recruitment</code> is a function and list of parameters that defines how annual recruitment should be generated (for more on how recruitment functions work withing the package see: ___).</li>
</ul>
</div>
<div class="section level5">
<h5 id="setting-up-a-harvest-control-rule">Setting up a Harvest Control Rule<a class="anchor" aria-label="anchor" href="#setting-up-a-harvest-control-rule"></a>
</h5>
<p>Second, users must define a harvest control rule (HCR) function that relates the current population state to a future fishing mortality rate. We provide several pre-built HCR functions, including the currently adopted Tier 3a rule (below) that is used to by the NPFMC to set ABCs for Alaska sablefish, but users can also define their own custom HCR functions (see ____ for more details on custom HCR functions).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tier3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ref_pts</span>, <span class="va">naa</span>, <span class="va">dem_params</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># Compute SSB from the current numbers-at-age matrix</span></span>
<span>    <span class="va">ssb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">naa</span><span class="op">[</span>,,<span class="fl">1</span>,<span class="op">]</span><span class="op">*</span><span class="va">dem_params</span><span class="op">$</span><span class="va">waa</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">*</span><span class="va">dem_params</span><span class="op">$</span><span class="va">mat</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span></span>
<span>    <span class="co"># Compute F based on the NPFMC Tier 3a rule</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/npfmc_tier3_F.html">npfmc_tier3_F</a></span><span class="op">(</span><span class="va">ssb</span>, <span class="va">ref_pts</span><span class="op">$</span><span class="va">B40</span>, <span class="va">ref_pts</span><span class="op">$</span><span class="va">F40</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function object is provided directly to the <code>run_mse</code> function, and is evaluated within the MSE function itself. For this reason, defining HCR functions must be done carefully with respect to the parameter inputs and function outputs (see ___ for details).</p>
</div>
<div class="section level5">
<h5 id="running-the-mse">Running the MSE<a class="anchor" aria-label="anchor" href="#running-the-mse"></a>
</h5>
<p>Once an OM object and HCR function have been correctly defined, running the MSE is as simple as:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_mse.html">run_mse</a></span><span class="op">(</span></span>
<span>  om<span class="op">=</span><span class="va">sable_om</span>,</span>
<span>  hcr<span class="op">=</span><span class="va">tier3</span>,</span>
<span>  nyears_input <span class="op">=</span> <span class="va">nyears</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>The <code>nyears_input</code> parameter defined how many years for the MSE to project forward. There is also a parameter <code>spinup_years</code> which can be used to define how many years to run the OM forward for, before the estimation model starts being used to set future TACs via the HCR. By default, <code>spinup_years = 64</code> which is specific to Alaska sablefish.</p>
<p><em>Tests have not been performed to verify the behavior of the MSE when the <code>spinup_years</code> parameter is different from 64.</em></p>
<p>There is a wrapper function for performing many MSE runs across different random seeds in parallel. For more information on parallel MSE simulations, see _____.</p>
</div>
<div class="section level5">
<h5 id="processing-mse-outputs">Processing MSE outputs<a class="anchor" aria-label="anchor" href="#processing-mse-outputs"></a>
</h5>
<p>The MSE function returns a large amount of data back to the user including numbers-at-age and sex for every year (both true and estimated), fishing-mortality-at-age (true and estimated), and the recommended F from the HCR in each year. To facilitate easier processing of these results, especially when MSEs with different OMs or different HCRs are being compared, a <code>bind_mse_outputs</code> function has been provided.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">model_runs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="va">mse</span></span>
<span><span class="op">)</span></span>
<span><span class="va">extra_columns</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    hcr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tier3"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/bind_mse_outputs.html">bind_mse_outputs</a></span><span class="op">(</span><span class="va">model_runs</span>, var<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"naa"</span>, <span class="st">"naa_est"</span><span class="op">)</span>, <span class="va">extra_columns</span><span class="op">)</span></span></code></pre></div>
<p>To use the <code>bind_mse_outputs</code> function, place the finished MSE objects into an unnamed list (<code>model_runs</code> in this case), create a named list of extra columns you want appended to the output data frame (<code>extra_columns</code> in this case; often this is going to just be the HCR and/or the OM that was used, but see ___ for more details on how this should be created), and determine the data you would like to pull from the MSE objects (<code>"naa"</code> and <code>"naa_est"</code> in this case). The resulting dataframe object with contain just the provided data the user asks for, in long format. From there, the user can manipulate the output data as necesarry for computing performance metrics or plotting results.</p>
<p>Three wrapper functions, <code>get_ssb_biomass</code>, <code>get_fishing_mortalities</code>, and <code>get_recruits</code>, are provided to easily compute and return common quantities (spawning biomass and total biomass, fishing mortality, and recruitment respectively).</p>
<p>Below is an example of one way how users may plot SSB.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plot spawning biomass from OM and EM</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">get_ssb_biomass</span><span class="op">(</span><span class="va">model_runs</span>, <span class="va">extra_columns</span>, <span class="va">sable_om</span><span class="op">$</span><span class="va">dem_params</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co"># SSB is females only</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">sex</span> <span class="op">==</span> <span class="st">"F"</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co"># summarise SSB across year and sim </span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span>, <span class="va">hcr</span>, <span class="va">sim</span>, <span class="va">L1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">summarise</span><span class="op">(</span>spbio<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">spbio</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co"># Compute quantiles of SSB distribution</span></span>
<span>    <span class="fu">group_by</span><span class="op">(</span><span class="va">time</span>, <span class="va">hcr</span>, <span class="va">L1</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="fu">median_qi</span><span class="op">(</span><span class="va">spbio</span>, .width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.50</span>, <span class="fl">0.80</span><span class="op">)</span>, .simple_names<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>    <span class="co"># Reformat ggdist tibble into long format</span></span>
<span>    <span class="fu"><a href="../reference/reformat_ggdist_long.html">reformat_ggdist_long</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">ggplot</span><span class="op">(</span><span class="va">d</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">L1</span> <span class="op">==</span> <span class="st">"naa"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu">geom_lineribbon</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">median</span>, ymin<span class="op">=</span><span class="va">lower</span>, ymax<span class="op">=</span><span class="va">upper</span>, group<span class="op">=</span><span class="va">hcr</span><span class="op">)</span>, size<span class="op">=</span><span class="fl">0.4</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_pointrange</span><span class="op">(</span>data <span class="op">=</span> <span class="va">d</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/stats/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">L1</span> <span class="op">==</span> <span class="st">"naa_est"</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x<span class="op">=</span><span class="va">time</span>, y<span class="op">=</span><span class="va">median</span>, ymin<span class="op">=</span><span class="va">lower</span>, ymax<span class="op">=</span><span class="va">upper</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.35</span>, color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_vline</span><span class="op">(</span>xintercept<span class="op">=</span><span class="fl">64</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">geom_hline</span><span class="op">(</span>yintercept<span class="op">=</span><span class="fl">121.4611</span>, linetype<span class="op">=</span><span class="st">"dashed"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">scale_fill_brewer</span><span class="op">(</span>palette<span class="op">=</span><span class="st">"Blues"</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">scale_y_continuous</span><span class="op">(</span>limits<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">300</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">coord_cartesian</span><span class="op">(</span>expand<span class="op">=</span><span class="fl">0</span><span class="op">)</span><span class="op">+</span></span>
<span>    <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Joshua Zahner, Benjamin Williams, Dan Goethel, Curry Cunningham.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>

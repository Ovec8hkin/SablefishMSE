<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Harvest Control Rules • SablefishMSE</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Harvest Control Rules">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">SablefishMSE</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.0000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/SablefishMSE.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/00_sablefish_example.html">Sablefish MSE Example</a></li>
    <li><a class="dropdown-item" href="../articles/01_operating_model.html">Defining an Operating Model</a></li>
    <li><a class="dropdown-item" href="../articles/02_recruitment.html">Specifying Recruitment</a></li>
    <li><a class="dropdown-item" href="../articles/03_estimation_model.html">Estimation Method</a></li>
    <li><a class="dropdown-item" href="../articles/04_harvest_control_rule_function.html">Harvest Control Rules</a></li>
    <li><a class="dropdown-item" href="../articles/05_running_mse.html">Running the MSE</a></li>
    <li><a class="dropdown-item" href="../articles/06_processing_mse_results.html">Processing MSE Output Data</a></li>
    <li><a class="dropdown-item" href="../articles/07_plotting_mse_results.html">Visualizing MSE Outputs</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Harvest Control Rules</h1>
            
      

      <div class="d-none name"><code>04_harvest_control_rule_function.Rmd</code></div>
    </div>

    
    
<p>Users must provide as input to the MSE function a list object that
defines the harvest control rule (HCR) to apply to the population in
each timestep. HCRs can take many forms including constant catch,
constant fishing mortality, threshold, etc. Several HCR functions are
provided as part of the package, including the current Tier 3a HCR used
by the North Pacific Fisheries Management Council for Alaska sablefish,
but users can also define custom HCR functions for their own
purposes.</p>
<p>A simple example of an HCR function is as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">npfmc_tier3_F</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ssb</span>, <span class="va">B_ref</span>, <span class="va">F_ref</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">ssb</span><span class="op">/</span><span class="va">B_ref</span></span>
<span>    <span class="va">f_min</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">f_max</span> <span class="op">=</span> <span class="va">F_ref</span></span>
<span>    <span class="va">lrp</span> <span class="op">=</span> <span class="fl">0.05</span></span>
<span>    <span class="va">urp</span> <span class="op">=</span> <span class="fl">1</span> </span>
<span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="va">urp</span><span class="op">)</span>  <span class="cn">F</span> <span class="op">&lt;-</span> <span class="va">f_max</span> <span class="co"># if stock status &gt;= 1</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="va">lrp</span> <span class="op">&amp;&amp;</span> <span class="va">x</span> <span class="op">&lt;</span> <span class="va">urp</span><span class="op">)</span> <span class="cn">F</span> <span class="op">&lt;-</span> <span class="va">f_max</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">lrp</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">urp</span><span class="op">-</span><span class="va">lrp</span><span class="op">)</span><span class="op">)</span> <span class="co"># if stock status &gt; alpha &amp; stock status &lt; 1</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="va">lrp</span><span class="op">)</span> <span class="cn">F</span> <span class="op">&lt;-</span> <span class="va">f_min</span></span>
<span>    </span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="cn">F</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">tier3</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ref_pts</span>, <span class="va">naa</span>, <span class="va">dem_params</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># Calculate ssb as naa*waa*mat (female only)</span></span>
<span>    <span class="va">ssb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">naa</span><span class="op">[</span>,,<span class="fl">1</span>,<span class="op">]</span><span class="op">*</span><span class="va">dem_params</span><span class="op">$</span><span class="va">waa</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">*</span><span class="va">dem_params</span><span class="op">$</span><span class="va">mat</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="../reference/npfmc_tier3_F.html">npfmc_tier3_F</a></span><span class="op">(</span><span class="va">ssb</span>, <span class="va">ref_pts</span><span class="op">$</span><span class="va">B40</span>, <span class="va">ref_pts</span><span class="op">$</span><span class="va">F40</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><img src="04_harvest_control_rule_function_files/figure-html/visualize_tier3_hcr-1.png" width="\textwidth" height="\textheight"></p>
<p>The function <code>npfmc_tier3_F</code> defines the NPFMC Tier 3a HCR
that is currently used for sablefish management in Alaska. The HCR is a
threshold rule that converts annual SSB into an allowable fishing
mortality rate (see ____) based on a maximum reference level for F and a
biomass reference level. The wrapper function <code>tier3()</code>
encapsulates converting from numbers-at-age (<code>naa</code>, the unit
of output from the OM) into SSB for the <code>npfmc_tier3_F</code>
function.</p>
<p>In order for an HCR function to be compatible with the MSE framework,
it must take, at minimum, three parameters: <code>ref_pts</code>,
<code>naa</code>, and <code>dem_params</code>. The <code>ref_pts</code>
input parameter expects an object generated via the
<code><a href="../reference/calculate_ref_points.html">calculate_ref_points()</a></code> function that the MSE runs
internally. The <code>naa</code> input parameter is a four dimensional
array (dims [1, nages, nsexes, 1]) of numbers-at-age as output by either
the OM or the EM. Finally, the <code>dem_params</code> input parameter
is the demographic parameter matrix that is supplied as part of the OM
definition.</p>
<p>All three of these parameters are required even for HCRs that may not
make direct use of one or more of such parametrs (such as a constant
catch rule, which doesn’t require any of them). More complex HCR
functions may optionally take additional parameters. Construction of
such HCRs is discussed later.</p>
<div class="section level4">
<h4 id="defining-the-management-procedure-object">Defining the Management Procedure Object<a class="anchor" aria-label="anchor" href="#defining-the-management-procedure-object"></a>
</h4>
<p>The combination of a stock assessment method, harvest control rule,
and management implementation process is known as a “management
procedure”. The <code>run_mse(...)</code> function, and its associated
wrapper functions, require as input a list object that defines the
management procedure. These “MP” list objects take the folowing
form:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a> mp <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>    <span class="at">hcr =</span> <span class="fu">list</span>(</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a>        <span class="at">func =</span> hcr_func, <span class="co"># the HCR function to evaluate</span></span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>        <span class="at">extra_pars =</span> <span class="cn">NA</span>, <span class="co"># any additional parameter values that are needed by the HCR function</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>        <span class="at">extra_options =</span> <span class="fu">list</span>(</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>            <span class="at">max_stability =</span> <span class="cn">NA</span>, <span class="co"># a maximum permissable annual change in TACs (as a proportion)</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>            <span class="at">harvest_cap =</span> <span class="cn">NA</span>    <span class="co"># a maximum permissable annual TAC</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>        ),</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>        <span class="at">units =</span> <span class="st">"F"</span> <span class="co"># the output units of the HCR function (should usually be "F" or "TAC")</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>    )</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>    <span class="at">ref_points =</span> <span class="fu">list</span>(</span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>        <span class="at">spr_target =</span> <span class="fl">0.40</span>   <span class="co"># the target SPR level for SPR-based reference points</span></span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a>    ),</span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>    <span class="at">management =</span> <span class="fu">list</span>(</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a>        <span class="at">abc_tac_reduction =</span> <span class="dv">1</span>, <span class="co"># proportion of the ABC to set the TAC too</span></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a>        <span class="at">tac_land_reduction =</span> <span class="dv">1</span> <span class="co"># proprtion of the TAC to set realized landings too</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a>    )</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>)</span></code></pre></div>
<p>Required elements of MP objects include:</p>
<ul>
<li><p><code>hcr$func</code>: a reference to an R function that defines
the harvest control rule</p></li>
<li><p><code>hcr$extra_pars</code>: a list of additional parameter
values required by the HCR function. These values must be provided at
runtime and can not be dynamically calculated based on internal state
variables.</p></li>
<li><p><code>hcr$units</code>: the output units of the HCR function
(should be either “F” or “TAC”). If “TAC”, the <code>run_mse</code>
function will compute the corresponding F that would result in the
output TAC</p></li>
<li><p><code>hcr$extra_options$max_stability</code>: the maximum
permissable annual change in TACs as a proportion. If <code>NA</code>
(the default), any change in TAC betwen successive years is
allowed.</p></li>
<li><p><code>hcr$extra_options$harvest_cap</code>: the maximum
permissable TAC. If <code>NA</code> (the default), any TAC, as computed
from the HCR function is allowed, otherwise, HCR computed TACs that
exceed this value, will be capped back down to the value
specified.</p></li>
<li><p><code>ref_points$spr_target</code>: the target SPR level for
SPR-based reference points</p></li>
<li><p><code>management$abc_tac_reduction</code>: the proportion of the
ABC to set the TAC too. HCR functions are used to compute the ABC
(Acceptable Biological Catch), which is a maximum permissable TAC, but
TACs are often set lower than ABC. This parameter captures that
reduction level. <em>Default value is 1</em>.</p></li>
<li><p><code>management$tac_land_reduction</code>: the proportion of the
TAC to set the following years realized landings too. For use when the
entire TAC is not utilized by the fishery. <em>Default value is
1</em>.</p></li>
</ul>
<p>The <code>abc_tac_reduction</code> and
<code>tac_land_reduction</code> can, optionally, also be calculated
internally based on a provided function and list of parameters. The
below example will calculate the annual <code>tac_land_reduction</code>
using the “stairstep_attainment” function and the associated parameter
values.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mp</span><span class="op">$</span><span class="va">management</span><span class="op">$</span><span class="va">tac_land_reduction</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    func <span class="op">=</span> <span class="va">stairstep_attainment</span>,</span>
<span>    pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        breakpoints <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">30</span><span class="op">)</span>,</span>
<span>        levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.9</span>, <span class="fl">0.8</span>, <span class="fl">0.6</span><span class="op">)</span>,</span>
<span>        phase_ins <span class="op">=</span> <span class="fl">0</span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>A default <code>mp</code> object can be generated from the
<code><a href="../reference/setup_mp_options.html">setup_mp_options()</a></code> function. Default MP objects do not have
an HCR element defined. HCR objects must be defined by the user and
inserted into the <code>mp</code> object.</p>
<p>This list object is then supplied as an input to the
<code>run_mse(...)</code> function or its associated wrapper functions,
like: <code>run_mse(..., hcr=mp_obj, ...)</code>.</p>
</div>
<div class="section level4">
<h4 id="constructing-a-new-hcr-function">Constructing a New HCR Function<a class="anchor" aria-label="anchor" href="#constructing-a-new-hcr-function"></a>
</h4>
<p>Here, we show how to construct a new step-wise harvest control rule
function, where F=0.10 when SSB &gt; 100,000 tons, and where F=0.01 when
SSB &lt;= 100,000 tons.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">step_hcr</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ref_pts</span>, <span class="va">naa</span>, <span class="va">dem_params</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># Calculate ssb as naa*waa*mat (female only) in units of 1,000s tons</span></span>
<span>    <span class="va">ssb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">naa</span><span class="op">[</span>,,<span class="fl">1</span>,<span class="op">]</span><span class="op">*</span><span class="va">dem_params</span><span class="op">$</span><span class="va">waa</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">*</span><span class="va">dem_params</span><span class="op">$</span><span class="va">mat</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">ssb</span> <span class="op">&gt;</span> <span class="fl">100</span>, <span class="fl">0.10</span>, <span class="fl">0.01</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">hcr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    func <span class="op">=</span> <span class="va">step_hcr</span>, <span class="co"># the HCR function to evaluate</span></span>
<span>    extra_pars <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># no extra parameter needed</span></span>
<span>    extra_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        max_stability <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># no stability constraints</span></span>
<span>        harvest_cap <span class="op">=</span> <span class="cn">NA</span> <span class="co"># no harvest caps</span></span>
<span>    <span class="op">)</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"F"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_mp_options.html">setup_mp_options</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mp</span><span class="op">$</span><span class="va">hcr</span> <span class="op">&lt;-</span> <span class="va">hcr</span></span>
<span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_mse.html">run_mse</a></span><span class="op">(</span>om<span class="op">=</span><span class="va">om</span>, hcr<span class="op">=</span><span class="va">hcr</span>, nyears_input<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>The HCR function above (<code>step_hcr</code>) takes the three
required parameters as inputs, though only makes use of <code>naa</code>
and <code>dem_params</code> (if users write a function that does not
take all three parameters as inputs, the MSE function will fail when
attempting to evaluate the HCR function).</p>
</div>
<div class="section level4">
<h4 id="constructing-more-complex-hcr-functions">Constructing More Complex HCR Functions<a class="anchor" aria-label="anchor" href="#constructing-more-complex-hcr-functions"></a>
</h4>
<p>Some HCRs require more information than just the three required
parameters to be defined. For example, consider an HCR that wants to
dynamically reduce the maximum F applied by a threshold HCR based on the
average age of the population in a given year. Such an HCR can be
defined like below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">average_age</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">naa</span>, <span class="va">ages</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">ages</span>, <span class="va">naa</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">avgage_threshold_f</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ref_pts</span>, <span class="va">naa</span>, <span class="va">dem_params</span>, <span class="va">ref_naa</span>, <span class="va">ages</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="co"># Calculate ssb as naa*waa*mat (female only) in units of 1,000s tons</span></span>
<span>    <span class="va">ssb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">naa</span><span class="op">[</span>,,<span class="fl">1</span>,<span class="op">]</span><span class="op">*</span><span class="va">dem_params</span><span class="op">$</span><span class="va">waa</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span><span class="op">*</span><span class="va">dem_params</span><span class="op">$</span><span class="va">mat</span><span class="op">[</span>,,<span class="fl">1</span>,,drop<span class="op">=</span><span class="cn">FALSE</span><span class="op">]</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span></span>
<span>    <span class="va">as_stat</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/average_age.html">average_age</a></span><span class="op">(</span><span class="va">naa</span>, <span class="va">ages</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="../reference/average_age.html">average_age</a></span><span class="op">(</span><span class="va">ref_naa</span>, <span class="va">ages</span><span class="op">)</span></span>
<span>    <span class="va">as_scalar</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/threshold_f.html">threshold_f</a></span><span class="op">(</span><span class="va">as_stat</span>, f_min<span class="op">=</span><span class="fl">0</span>, f_max<span class="op">=</span><span class="fl">1</span>, lrp<span class="op">=</span><span class="fl">0</span>, urp<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">x</span> <span class="op">&lt;-</span> <span class="va">ssb</span><span class="op">/</span><span class="va">ref_pts</span><span class="op">$</span><span class="va">B40</span></span>
<span>    <span class="va">f_max</span> <span class="op">&lt;-</span> <span class="va">ref_pts</span><span class="op">$</span><span class="va">F40</span><span class="op">*</span><span class="va">as_scalar</span></span>
<span>    <span class="va">f_min</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">lrp</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span>    <span class="va">urp</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;=</span> <span class="va">urp</span><span class="op">)</span>  <span class="cn">F</span> <span class="op">&lt;-</span> <span class="va">f_max</span> <span class="co"># if stock status &gt;= 1</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="va">lrp</span> <span class="op">&amp;&amp;</span> <span class="va">x</span> <span class="op">&lt;</span> <span class="va">urp</span><span class="op">)</span> <span class="cn">F</span> <span class="op">&lt;-</span> <span class="va">f_max</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="va">x</span><span class="op">-</span><span class="va">lrp</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">urp</span><span class="op">-</span><span class="va">lrp</span><span class="op">)</span><span class="op">)</span> <span class="co"># if stock status &gt; alpha &amp; stock status &lt; 1</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;=</span> <span class="va">lrp</span><span class="op">)</span> <span class="cn">F</span> <span class="op">&lt;-</span> <span class="va">f_min</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">f</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The <code>avgeage_threshold_f</code> HCR function accepts two more
parameters (<code>ref_naa</code> and <code>ages</code>) than are
required by all HCR functions. The values for these parameters should be
placed in the <code>hcr$extra_pars</code> list element that is required
for defining an HCR object. So, for this example, the final MSE call
would look something like:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ages</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">:</span><span class="fl">31</span></span>
<span><span class="va">ref_naa</span> <span class="op">&lt;-</span> <span class="fl">25</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>, \<span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fl">1</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.1</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="va">i</span><span class="op">)</span></span>
<span></span>
<span><span class="va">hcr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    func <span class="op">=</span> <span class="va">avgage_threshold_f</span>, <span class="co"># the HCR function to evaluate</span></span>
<span>    extra_pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        <span class="co"># extra parameter values required by the "avgage_threshold_f function"</span></span>
<span>        ref_naa <span class="op">=</span> <span class="va">ref_naa</span>, </span>
<span>        ages <span class="op">=</span> <span class="va">age</span></span>
<span>    <span class="op">)</span>,</span>
<span>    extra_options <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>        max_stability <span class="op">=</span> <span class="cn">NA</span>, <span class="co"># a maximum permissable annual change in TACs (as a proportion)</span></span>
<span>        harvest_cap <span class="op">=</span> <span class="cn">NA</span> <span class="co"># a maximum permissable annual TAC</span></span>
<span>    <span class="op">)</span>,</span>
<span>    units <span class="op">=</span> <span class="st">"F"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">mp</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setup_mp_options.html">setup_mp_options</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">mp</span><span class="op">$</span><span class="va">hcr</span> <span class="op">&lt;-</span> <span class="va">hcr</span></span>
<span></span>
<span><span class="va">mse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/run_mse.html">run_mse</a></span><span class="op">(</span>om<span class="op">=</span><span class="va">om</span>, hcr<span class="op">=</span><span class="va">mp</span>, nyears_input<span class="op">=</span><span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>This pattern extends to any HCR function, even ones that require
dozens of additional parameters (parameter names still need to be
unique, so paramaters cannot have names likes <code>om</code>,
<code>hcr</code>, <code>ref_pts</code>, <code>naa</code>, etc. as they
are already used by either the calling MSE function or are default
parameters alredy supplued to the HCR function.</p>
</div>
<div class="section level4">
<h4 id="additional-hcr-complexity">Additional HCR Complexity<a class="anchor" aria-label="anchor" href="#additional-hcr-complexity"></a>
</h4>
<p>HCRs can also have additional “meta-rules” that further define their
behavior. A common example are stability constraints, which limit how
much annual catch levels are allowed to change between years. These
constraints are defined by the <code>extra_options</code> list object
within the larged HCR object definition.</p>
<p>To supply additional management rules, such as stability constraints
or harvest caps, a named list <code>extra_options</code> must be added
to the larger <code>hcr</code> list object. The
<code>extra_options</code> list object, can, presently, define two
parameters:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hcr</span><span class="op">$</span><span class="va">extra_options</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    max_stability <span class="op">=</span> <span class="fl">0.15</span>,   <span class="co"># maximum allowed percent increase in TAC between successive years</span></span>
<span>    harvest_cap <span class="op">=</span> <span class="fl">100000</span>    <span class="co"># maximum allowed TAC</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><em>NOTE: The interface for defining complex HCR functions and for
defining additional management meta-rules is subject to change
(07/22/2024).</em></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Joshua Zahner, Benjamin Williams, Dan Goethel, Curry Cunningham, Matt Cheng.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
